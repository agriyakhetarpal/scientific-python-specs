<!DOCTYPE html>
<html lang="en-us" data-colorscheme="auto" >
  <head>
    <!-- Generated 2025-04-21 11:22:09 UTC -->
    <meta name="description" content="Community developed and owned ecosystem for scientific computing" />
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

    
    <title>Scientific Python - SPEC 7 — Seeding Pseudo-Random Number Generation</title>

    
    
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;900">

<link rel="icon" href="../../images/favicon.ico" />

  
      <link rel="stylesheet" type="text/css" href="../../theme-css/sphinx-design/index.scss.min.acf226aa2ff428a500491b1393bef415c3883113dac542174f5814fba5532592.css" integrity="sha256-rPImqi/0KKUASRsTk770FcOIMRPaxUIXT1gU&#43;6VTJZI=">  
      <link rel="stylesheet" type="text/css" href="../../theme-css/pst/bootstrap.scss.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU=">  
      <link rel="stylesheet" type="text/css" href="../../theme-css/pst/pydata-sphinx-theme.scss.min.1032a66ba1e0ab03bfcbfd265dce1d831879c5ea9d57e8575a68eeeb887b617e.css" integrity="sha256-EDKma6HgqwO/y/0mXc4dgxh5xeqdV&#43;hXWmju64h7YX4=">  
      <link rel="stylesheet" type="text/css" href="../../theme-css/spht/index.scss.min.ad03de1683bb39a0d1b31395797b97188e59cda6d778c0671a99db0b4fb799a9.css" integrity="sha256-rQPeFoO7OaDRsxOVeXuXGI5ZzabXeMBnGpnbC0&#43;3mak=">
    <link rel="stylesheet" href="../../theme-css/backtotop.min.af4a1eb2a3e4e5ca38353a8320dafc9b1e1fd2edd480caa5fff0ae4e751d991c.css" integrity="sha256-r0oesqPk5co4NTqDINr8mx4f0u3UgMql//CuTnUdmRw=">
    <link rel="stylesheet" href="../../theme-css/bulma.min.f488b160722c9b7a2a760c03808dc8df5173e6c9dd25cb7481451ddb3c4f35dc.css" integrity="sha256-9IixYHIsm3oqdgwDgI3I31Fz5sndJct0gUUd2zxPNdw=">
    <link rel="stylesheet" href="../../theme-css/code-highlight.min.d0bd96ff1dbeb4b62536da5935b92af5cd7edb6d6f52b316d721e62078d9f089.css" integrity="sha256-0L2W/x2&#43;tLYlNtpZNbkq9c1&#43;221vUrMW1yHmIHjZ8Ik=">
    <link rel="stylesheet" href="../../theme-css/content.min.1de9b096ffc099fee4b538589fea6b622be33d69de64c451e11f2c91476029c5.css" integrity="sha256-Hemwlv/Amf7ktThYn&#43;prYivjPWneZMRR4R8skUdgKcU=">
    <link rel="stylesheet" href="../../theme-css/dark-mode.min.5acf8f4101cd9f24228036af1488ce5c137f9c7e45fbc9c24c20200ea5140ac0.css" integrity="sha256-Ws&#43;PQQHNnyQigDavFIjOXBN/nH5F&#43;8nCTCAgDqUUCsA=">
    <link rel="stylesheet" href="../../theme-css/footer.min.4be63c4d5628cb485efcfa5c9475fa1daa18933eb83741a2ca2bcd444ec270a2.css" integrity="sha256-S&#43;Y8TVYoy0he/PpclHX6HaoYkz64N0GiyivNRE7CcKI=">
    <link rel="stylesheet" href="../../theme-css/hero.min.aa8286fd7d31d78e297e71594436c47b17d4f28660fd16f2b252e3f55fa500be.css" integrity="sha256-qoKG/X0x144pfnFZRDbEexfU8oZg/RbyslLj9V&#43;lAL4=">
    <link rel="stylesheet" href="../../theme-css/lists.min.83821789384ebadc1a1ff75ef9f4b29ba53fe45eb30a46a228aa55772a393396.css" integrity="sha256-g4IXiThOutwaH/de&#43;fSym6U/5F6zCkaiKKpVdyo5M5Y=">
    <link rel="stylesheet" href="../../theme-css/navbar.min.c15f7eadb5a7e1532309c04d94e1b0099d4fa75aaded30829bbfd21ebdb51ad5.css" integrity="sha256-wV9&#43;rbWn4VMjCcBNlOGwCZ1Pp1qt7TCCm7/SHr21GtU=">
    <link rel="stylesheet" href="../../theme-css/news.min.8875ffae62ae22741a27025581fcb3341c18442be06bf132e45f8d6027692876.css" integrity="sha256-iHX/rmKuInQaJwJVgfyzNBwYRCvga/Ey5F&#43;NYCdpKHY=">
    <link rel="stylesheet" href="../../theme-css/posts.min.9505f87d5973f3f08c99c613c0781b3a42411f4795657e8da7ef29c7ad37c23d.css" integrity="sha256-lQX4fVlz8/CMmcYTwHgbOkJBH0eVZX6Np&#43;8px603wj0=">
    <link rel="stylesheet" href="../../theme-css/search.min.ee3423de82ad5535fd375aa47bc4fe618ecaa5d10eb0b68fe6dfc85a78790676.css" integrity="sha256-7jQj3oKtVTX9N1qke8T&#43;YY7KpdEOsLaP5t/IWnh5BnY=">
    <link rel="stylesheet" href="../../theme-css/shortcuts.min.f90addf0a2a3c4e075eb5c3c78e4cc27d9b4fba18a02a17808695212762224c1.css" integrity="sha256-&#43;Qrd8KKjxOB161w8eOTMJ9m0&#43;6GKAqF4CGlSEnYiJME=">
    <link rel="stylesheet" href="../../theme-css/styles.min.00c75e5e25cb21123ca151cb4f4a130891157870829d91cefa425316ecf23de2.css" integrity="sha256-AMdeXiXLIRI8oVHLT0oTCJEVeHCCnZHO&#43;kJTFuzyPeI=">
    <link rel="stylesheet" href="../../theme-css/tables.min.7a44b6bd698323dd3d379b714bd534132e76bf4ba0d3dec61997a8d9ba9db5fb.css" integrity="sha256-ekS2vWmDI909N5txS9U0Ey52v0ug097GGZeo2bqdtfs=">
    <link rel="stylesheet" href="../../theme-css/tabs.min.8884c317231b5f2331b2fd9f65e4f7900fe9124aafae93b78cef175960289683.css" integrity="sha256-iITDFyMbXyMxsv2fZeT3kA/pEkqvrpO3jO8XWWAoloM=">
    <link rel="stylesheet" href="../../theme-css/vars.min.3d537d14ea6e6fb59012fa9d357adf4b209dab8c2535fb94ab37afb6a37020fd.css" integrity="sha256-PVN9FOpub7WQEvqdNXrfSyCdq4wlNfuUqzevtqNwIP0=">
    <link rel="stylesheet" href="../../css/custom.min.aee833ad7adac4c1bf8442e439dc06cfdbce30777bb985654641a329ce6b60da.css" integrity="sha256-rugzrXraxMG/hELkOdwGz9vOMHd7uYVlRkGjKc5rYNo=">
    


    
    

    
    
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://scientific-python.org/images/logo.svg">
  <meta name="twitter:title" content="SPEC 7 — Seeding Pseudo-Random Number Generation">
  <meta name="twitter:description" content="Description# Currently, libraries across the ecosystem provide various APIs for seeding pseudo-random number generation. This SPEC suggests a unified, pragmatic API, taking into account technical and historical factors. Adopting such a uniform API will simplify the user experience, especially for those who rely on multiple projects.
We recommend:
standardizing the usage and interpretation of an rng keyword for seeding, and avoiding the use of global state and legacy bitstream generators. We suggest implementing these principles by:">

  </head>
  <body>
    
    
<nav id="nav" class="navbar" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../">
        <img class="navbar-logo" src="../../images/logo.svg" alt="A green tree on a white hill at the end of a green path in the shape of the letter &#39;S&#39;.">
        <div class="navbar-logo-text">Scientific Python</div>
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbar-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbar-menu" class="navbar-menu">

      <div class="navbar-end">
        <a href="../../" class="navbar-item">
          Home
        </a>
        <a href="https://blog.scientific-python.org" class="navbar-item">
          Blog
        </a>
        <a href="https://learn.scientific-python.org" class="navbar-item">
          Learn
        </a>
        <a href="https://tools.scientific-python.org" class="navbar-item">
          Tools
        </a>

      </div>
    </div>
  </div>
</nav>


    

    
<section class="article content-padding flex-row">
  <div class="content-container">
    <nav aria-label="Breadcrumb">
<ul id="breadcrumbs" class="bd-breadcrumbs">
  <li class="breadcrumb-item breadcrumb-home"><a href="../../" class="nav-link" aria-label="Home"><i class="fas fa-home"></i></a></li>
  <li class="breadcrumb-item"><a href="../../specs/" class="nav-link">Scientific Python Ecosystem Coordination</a></li>

  <li class="breadcrumb-item active" aria-current="page">SPEC 7 — Seeding Pseudo-Random Number Generation</li>
</ul>
</nav>

    <h1>SPEC 7 — Seeding Pseudo-Random Number Generation</h1>
    
    
  <div class="sd-card sd-mb-3 sd-shadow-sm ">
 
   <div class="sd-card-body">
      <dl class="field-list">
  <dt class="field-odd">Authors<span class="colon">:</span></dt>
  <dd class="field-odd">Stéfan van der Walt &lt;stefanv@berkeley.edu&gt;, Sebastian Berg &lt;sebastianb@nvidia.com&gt;, Pamphile Roy &lt;roy.pamphile@gmail.com&gt;, Matt Haberland &lt;mhaberla@calpoly.edu&gt;</dd>
  <dt class="field-even">History<span class="colon">:</span></dt>
  <dd class="field-even"><a href="https://github.com/scientific-python/specs/commits/main/spec-0007">https://github.com/scientific-python/specs/commits/main/spec-0007</a></dd>
  <dt class="field-odd">Endorsed by<span class="colon">:</span></dt>
  <dd class="field-odd"><a href="../core-projects/ipython">ipython</a>, <a href="../core-projects/numpy">numpy</a>, <a href="../core-projects/scikit-image">scikit-image</a>, <a href="../core-projects/scipy">scipy</a></dd>
  <dt class="field-even">Discussion<span class="colon">:</span></dt>
  <dd class="field-even"><a href="#discourse-comments">Comments below</a></dd>
</dl>
   </div>
  </div>




    <div class="article-content">
      <h2 id="description">Description<a class="headerlink" href="#description" title="Link to this heading">#</a></h2>
<p>Currently, libraries across the ecosystem provide various APIs for seeding pseudo-random number generation.
This SPEC suggests a unified, pragmatic API, taking into account technical and historical factors.
Adopting such a uniform API will simplify the user experience, especially for those who rely on multiple projects.</p>
<p>We recommend:</p>
<ul>
<li>standardizing the usage and interpretation of an <code>rng</code> keyword for seeding, and</li>
<li>avoiding the use of global state and legacy bitstream generators.</li>
</ul>
<p>We suggest implementing these principles by:</p>
<ul>
<li>deprecating uses of an existing seed argument (commonly <code>random_state</code> or <code>seed</code>) in favor of a consistent <code>rng</code> argument,</li>
<li>using <code>numpy.random.default_rng</code> to normalize the <code>rng</code> argument and instantiate a <code>Generator</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, and</li>
<li>deprecating the use of <code>numpy.random.seed</code> to control the random state.</li>
</ul>
<p>We are primarily concerned with API uniformity, but also encourage libraries to move towards using <a href="https://numpy.org/doc/stable/reference/random/generator.html">NumPy pseudo-random <code>Generator</code>s</a> because:</p>
<ol>
<li><code>Generator</code>s avoid problems associated with naïve seeding (e.g., using successive integers), via its <a href="https://numpy.org/doc/stable/reference/random/parallel.html#seedsequence-spawning">SeedSequence</a> mechanism;</li>
<li>their use avoids relying on global state—which can make code execution harder to track, and may cause problems in parallel processing scenarios.</li>
</ol>
<h3 id="scope">Scope<a class="headerlink" href="#scope" title="Link to this heading">#</a></h3>
<p>This is intended as a recommendation to all libraries that allow users to control the state of a NumPy random number generator.
It is specifically targeted toward functions that currently accept random number seeds using an argument other than <code>rng</code>, rely on the particular behavior of <code>RandomState</code> methods, or allow <code>numpy.random.seed</code> to control the random state, but the ideas are more broadly applicable.
Random number generators other than those provided by NumPy could also be accommodated by an <code>rng</code> keyword, but that is beyond the scope of this SPEC.</p>
<h3 id="concepts">Concepts<a class="headerlink" href="#concepts" title="Link to this heading">#</a></h3>
<ul>
<li><code>BitGenerator</code>: Generates a stream of pseudo-random bits. The default generator in NumPy (<code>numpy.random.default_rng</code>) uses PCG64.</li>
<li><code>Generator</code>: Derives pseudo-random numbers from the bits produced by a <code>BitGenerator</code>.</li>
<li><code>RandomState</code>: a <a href="https://numpy.org/doc/stable/reference/random/index.html">legacy object in NumPy</a>, similar to <code>Generator</code>, that produces random numbers based on the Mersenne Twister.</li>
</ul>
<h3 id="constraints">Constraints<a class="headerlink" href="#constraints" title="Link to this heading">#</a></h3>
<p>NumPy, SciPy, scikit-learn, scikit-image, and NetworkX all implement pseudo-random seeding in slightly different ways.
Common keyword arguments include <code>random_state</code> and <code>seed</code>.
In practice, the seed is also often controllable using <code>numpy.random.seed</code>.</p>
<h3 id="core-project-endorsement">Core Project Endorsement<a class="headerlink" href="#core-project-endorsement" title="Link to this heading">#</a></h3>
<p>Endorsement of this SPEC means that a project considers the standardization and interpretation of the <code>rng</code> keyword, as well as avoiding use of global state and legacy bitstream generators, good ideas that are worth implemented widely.</p>
<h3 id="ecosystem-adoption">Ecosystem Adoption<a class="headerlink" href="#ecosystem-adoption" title="Link to this heading">#</a></h3>
<p>To adopt this SPEC, a project should:</p>
<ul>
<li>deprecate the use of <code>random_state</code>/<code>seed</code> arguments in favor of an <code>rng</code> argument in all functions where users need to control pseudo-random number generation,</li>
<li>use <code>numpy.random.default_rng</code> to normalize the <code>rng</code> argument and instantiate a <code>Generator</code>, and</li>
<li>deprecate the use of <code>numpy.random.seed</code> to control the random state.</li>
</ul>
<h4 id="badges">Badges<a class="headerlink" href="#badges" title="Link to this heading">#</a></h4>
<p>Projects can highlight their adoption of this SPEC by including a SPEC badge.

<div class="tabs">
  <div role="tablist" class="automatic">
    <button id="-tab-0" type="button" role="tab" aria-selected="true" aria-controls="-tabpanel-0">
      Rendered badge
    </button>
    <button id="-tab-1" type="button" role="tab" aria-selected="false" aria-controls="-tabpanel-1">
      Markdown
    </button>
    <button id="-tab-2" type="button" role="tab" aria-selected="false" aria-controls="-tabpanel-2">
      reStructuredText
    </button>
  </div>
  <div id="-tabpanel-0" role="tabpanel" tabindex="0" aria-labelledby="$-tab-0"><a href="https://scientific-python.org/specs/spec-0007/"><img src="https://img.shields.io/badge/SPEC-7-green?labelColor=%23004811&amp;color=%235CA038" alt="SPEC 7 — Seeding pseudo-random number generation"></a></div>
  <div id="-tabpanel-1" role="tabpanel" tabindex="0" aria-labelledby="$-tab-1">
<div class="highlight">
  <pre>[![SPEC 7 — Seeding pseudo-random number generation](https://img.shields.io/badge/SPEC-7-green?labelColor=%23004811&amp;color=%235CA038)](https://scientific-python.org/specs/spec-0007/)</pre>
</div>

</div>
  <div id="-tabpanel-2" role="tabpanel" tabindex="0" aria-labelledby="$-tab-2">
<div class="highlight">
  <pre>|SPEC 7 — Seeding pseudo-random number generation| 

.. |SPEC 7 — Seeding pseudo-random number generation| image:: https://img.shields.io/badge/SPEC-7-green?labelColor=%23004811&amp;color=%235CA038
   :target: https://scientific-python.org/specs/spec-0007/</pre>
</div>

</div>
</div>


To indicate adoption of multiple SPECS with one badge, see <a href="../purpose-and-process/#badges">this</a>.</p>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<p>Legacy behavior in packages such as scikit-learn (<code>sklearn.utils.check_random_state</code>) typically handle <code>None</code> (use the global seed state), an int (convert to <code>RandomState</code>), or <code>RandomState</code> object.</p>
<p>Our recommendation here is a deprecation strategy which does not in <em>all</em> cases adhere to the Hinsen principle<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>,
although it could very nearly do so by enforcing the use of <code>rng</code> as a keyword argument.</p>
<p>The <a href="https://github.com/scientific-python/specs/pull/180#issuecomment-1515248009">deprecation strategy</a> is as follows.</p>
<p><strong>Initially</strong>, accept both <code>rng</code> and the existing <code>random_state</code>/<code>seed</code>/<code>...</code> keyword arguments.</p>
<ul>
<li>If both are specified by the user, raise an error.</li>
<li>If <code>rng</code> is passed by keyword, normalize it with <code>np.random.default_rng()</code> and use it to generate random numbers as needed.</li>
<li>If <code>random_state</code>/<code>seed</code>/<code>...</code> is specified (by keyword or position, if allowed), preserve existing behavior.</li>
</ul>
<p><strong>After <code>rng</code> becomes available</strong> in all releases within the support window suggested by SPEC 0, emit warnings as follows:</p>
<ul>
<li>
<p>If neither <code>rng</code> nor <code>random_state</code>/<code>seed</code>/<code>...</code> is specified and <code>np.random.seed</code> has been used to set the seed, emit a <code>FutureWarning</code> about the upcoming change in behavior.</p>
</li>
<li>
<p>If <code>random_state</code>/<code>seed</code>/<code>...</code> is passed by keyword or by position, treat it as before, but:</p>
<ul>
<li>Emit a <code>DeprecationWarning</code> if passed by keyword, warning about the deprecation of keyword <code>random_state</code> in favor of <code>rng</code>.</li>
<li>Emit a <code>FutureWarning</code> if passed by position, warning about the change in behavior of the positional argument.</li>
</ul>
</li>
</ul>
<p><strong>After the deprecation period</strong>, accept only <code>rng</code>, raising an error if <code>random_state</code>/<code>seed</code>/<code>...</code> is provided.</p>
<p>By now, the function signature, with type annotations, could look like this:</p>


<div class="highlight">
  <pre class="chroma"><code><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SeedLike</span> <span class="o">=</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">SeedSequence</span>
</span></span><span class="line"><span class="cl"><span class="n">RNGLike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">BitGenerator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">rng</span><span class="p">:</span> <span class="n">RNGLike</span> <span class="o">|</span> <span class="n">SeedLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;My function summary.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    rng : `numpy.random.Generator`, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        Pseudorandom number generator state. When `rng` is None, a new
</span></span></span><span class="line"><span class="cl"><span class="s2">        `numpy.random.Generator` is created using entropy from the
</span></span></span><span class="line"><span class="cl"><span class="s2">        operating system. Types other than `numpy.random.Generator` are
</span></span></span><span class="line"><span class="cl"><span class="s2">        passed to `numpy.random.default_rng` to instantiate a ``Generator``.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">...</span></span></span></code></pre>
</div>
<p>Also note the suggested language for the <code>rng</code> parameter docstring, which encourages the user to pass a <code>Generator</code> or <code>None</code>, but allows for other types accepted by <code>numpy.random.default_rng</code> (captured by the type annotation).</p>
<h3 id="impact">Impact<a class="headerlink" href="#impact" title="Link to this heading">#</a></h3>
<p>There are three classes of users, which will be affected to varying degrees.</p>
<ol>
<li>
<p>Those who do not attempt to control the random state.
Their code will switch from using the unseeded global <code>RandomState</code> to using an unseeded <code>Generator</code>.
Since the underlying <em>distributions</em> of pseudo-random numbers will not change, these users should be largely unaffected.
While <em>technically</em> this change does not adhere to the Hinsen principle, its impact should be minimal.</p>
</li>
<li>
<p>Users of <code>random_state</code>/<code>seed</code> arguments.
Support for these arguments will be dropped eventually, but during the deprecation period, we can provide clear guidance, via warnings and documentation, on how to migrate to the new <code>rng</code> keyword.</p>
</li>
<li>
<p>Those who use <code>numpy.random.seed</code>.
The proposal will do away with that global seeding mechanism, meaning that code that relies on it would, after the deprecation period, go from being seeded to being unseeded.
To ensure that this does not go unnoticed, libraries that allowed for control of the random state via <code>numpy.random.seed</code> should raise a <code>FutureWarning</code> if <code>np.random.seed</code> has been called. (See <a href="#code">Code</a> below for an example.)
To fully adhere to the Hinsen principle, these warnings should instead be raised as errors.
In response, users will have to switch from using <code>numpy.random.seed</code> to passing the <code>rng</code> argument explicitly to all functions that accept it.</p>
</li>
</ol>
<h3 id="code">Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h3>
<p>As an example, consider how a SciPy function would transition from a <code>random_state</code> parameter to an <code>rng</code> parameter using a decorator.</p>


<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">functools</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_transition_to_rng</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">position_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Example decorator to transition from old PRNG usage to new `rng` behavior
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Suppose the decorator is applied to a function that used to accept parameter
</span></span></span><span class="line"><span class="cl"><span class="s2">    `old_name=&#39;random_state&#39;` either by keyword or as a positional argument at
</span></span></span><span class="line"><span class="cl"><span class="s2">    `position_num=1`. At the time of application, the name of the argument in the
</span></span></span><span class="line"><span class="cl"><span class="s2">    function signature is manually changed to the new name, `rng`. If positional
</span></span></span><span class="line"><span class="cl"><span class="s2">    use was allowed before, this is not changed.*
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    - If the function is called with both `random_state` and `rng`, the decorator
</span></span></span><span class="line"><span class="cl"><span class="s2">      raises an error.
</span></span></span><span class="line"><span class="cl"><span class="s2">    - If `random_state` is provided as a keyword argument, the decorator passes
</span></span></span><span class="line"><span class="cl"><span class="s2">      `random_state` to the function&#39;s `rng` argument as a keyword. If `end_version`
</span></span></span><span class="line"><span class="cl"><span class="s2">      is specified, the decorator will emit a `DeprecationWarning` about the
</span></span></span><span class="line"><span class="cl"><span class="s2">      deprecation of keyword `random_state`.
</span></span></span><span class="line"><span class="cl"><span class="s2">    - If `random_state` is provided as a positional argument, the decorator passes
</span></span></span><span class="line"><span class="cl"><span class="s2">      `random_state` to the function&#39;s `rng` argument by position. If `end_version`
</span></span></span><span class="line"><span class="cl"><span class="s2">      is specified, the decorator will emit a `FutureWarning` about the changing
</span></span></span><span class="line"><span class="cl"><span class="s2">      interpretation of the argument.
</span></span></span><span class="line"><span class="cl"><span class="s2">    - If `rng` is provided as a keyword argument, the decorator validates `rng` using
</span></span></span><span class="line"><span class="cl"><span class="s2">      `numpy.random.default_rng` before passing it to the function.
</span></span></span><span class="line"><span class="cl"><span class="s2">    - If `end_version` is specified and neither `random_state` nor `rng` is provided
</span></span></span><span class="line"><span class="cl"><span class="s2">      by the user, the decorator checks whether `np.random.seed` has been used to set
</span></span></span><span class="line"><span class="cl"><span class="s2">      the global seed. If so, it emits a `FutureWarning`, noting that usage of
</span></span></span><span class="line"><span class="cl"><span class="s2">      `numpy.random.seed` will eventually have no effect. Either way, the decorator
</span></span></span><span class="line"><span class="cl"><span class="s2">      calls the function without explicitly passing the `rng` argument.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    If `end_version` is specified, a user must pass `rng` as a keyword to avoid warnings.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    After the deprecation period, the decorator can be removed, and the function
</span></span></span><span class="line"><span class="cl"><span class="s2">    can simply validate the `rng` argument by calling `np.random.default_rng(rng)`.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    * A `FutureWarning` is emitted when the PRNG argument is used by
</span></span></span><span class="line"><span class="cl"><span class="s2">      position. It indicates that the &#34;Hinsen principle&#34; (same
</span></span></span><span class="line"><span class="cl"><span class="s2">      code yielding different results in two versions of the software)
</span></span></span><span class="line"><span class="cl"><span class="s2">      will be violated, unless positional use is deprecated. Specifically:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">      - If `None` is passed by position and `np.random.seed` has been used,
</span></span></span><span class="line"><span class="cl"><span class="s2">        the function will change from being seeded to being unseeded.
</span></span></span><span class="line"><span class="cl"><span class="s2">      - If an integer is passed by position, the random stream will change.
</span></span></span><span class="line"><span class="cl"><span class="s2">      - If an instance of `RandomState` is passed by position, either an
</span></span></span><span class="line"><span class="cl"><span class="s2">        error will be raised (NumPy &lt; 2.2.0), or it will be accepted
</span></span></span><span class="line"><span class="cl"><span class="s2">        (NumPy &gt;= 2.2.0) but the random numbers generated may be different
</span></span></span><span class="line"><span class="cl"><span class="s2">        from those that would be produced by the original `RandomState`.
</span></span></span><span class="line"><span class="cl"><span class="s2">      - If `np.random` is passed by position, an error will be raised.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">      We suggest that projects consider deprecating positional use of
</span></span></span><span class="line"><span class="cl"><span class="s2">      `random_state`/`rng` (i.e., change their function signatures to
</span></span></span><span class="line"><span class="cl"><span class="s2">      ``def my_func(..., *, rng=None)``); that might not make sense
</span></span></span><span class="line"><span class="cl"><span class="s2">      for all projects, so this SPEC does not make that
</span></span></span><span class="line"><span class="cl"><span class="s2">      recommendation, neither does this decorator enforce it.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    old_name : str
</span></span></span><span class="line"><span class="cl"><span class="s2">        The old name of the PRNG argument (e.g. `seed` or `random_state`).
</span></span></span><span class="line"><span class="cl"><span class="s2">    position_num : int, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        The (0-indexed) position of the old PRNG argument (if accepted by position).
</span></span></span><span class="line"><span class="cl"><span class="s2">        Maintainers are welcome to eliminate this argument and use, for example,
</span></span></span><span class="line"><span class="cl"><span class="s2">        `inspect`, if preferred.
</span></span></span><span class="line"><span class="cl"><span class="s2">    end_version : str, optional
</span></span></span><span class="line"><span class="cl"><span class="s2">        The full version number of the library when the behavior described in
</span></span></span><span class="line"><span class="cl"><span class="s2">        `DeprecationWarning`s and `FutureWarning`s will take effect. If left
</span></span></span><span class="line"><span class="cl"><span class="s2">        unspecified, no warnings will be emitted by the decorator.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">NEW_NAME</span> <span class="o">=</span> <span class="s2">&#34;rng&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cmn_msg</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;To silence this warning and ensure consistent behavior in SciPy &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">end_version</span><span class="si">}</span><span class="s2">, control the RNG using argument `</span><span class="si">{</span><span class="n">NEW_NAME</span><span class="si">}</span><span class="s2">`. Arguments passed &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;to keyword `</span><span class="si">{</span><span class="n">NEW_NAME</span><span class="si">}</span><span class="s2">` will be validated by `np.random.default_rng`, so the &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;behavior corresponding with a given value may change compared to use of &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="sa">f</span><span class="s2">&#34;`</span><span class="si">{</span><span class="n">old_name</span><span class="si">}</span><span class="s2">`. For example, &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;1) `None` will result in unpredictable random numbers, &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;2) an integer will result in a different stream of random numbers, (with the &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;same distribution), and &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;3) `np.random` or `RandomState` instances will result in an error. &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;See the documentation of `default_rng` for more information.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Determine how PRNG was passed</span>
</span></span><span class="line"><span class="cl">            <span class="n">as_old_kwarg</span> <span class="o">=</span> <span class="n">old_name</span> <span class="ow">in</span> <span class="n">kwargs</span>
</span></span><span class="line"><span class="cl">            <span class="n">as_new_kwarg</span> <span class="o">=</span> <span class="n">NEW_NAME</span> <span class="ow">in</span> <span class="n">kwargs</span>
</span></span><span class="line"><span class="cl">            <span class="n">as_pos_arg</span> <span class="o">=</span> <span class="n">position_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">position_num</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="n">emit_warning</span> <span class="o">=</span> <span class="n">end_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Can only specify PRNG one of the three ways</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">as_old_kwarg</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">as_new_kwarg</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">as_pos_arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">() got multiple values for &#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="sa">f</span><span class="s2">&#34;argument now known as `</span><span class="si">{</span><span class="n">NEW_NAME</span><span class="si">}</span><span class="s2">`&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check whether global random state has been set</span>
</span></span><span class="line"><span class="cl">            <span class="n">global_seed_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">mtrand</span><span class="o">.</span><span class="n">_rand</span><span class="o">.</span><span class="n">_bit_generator</span><span class="o">.</span><span class="n">_seed_seq</span> <span class="ow">is</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">as_old_kwarg</span><span class="p">:</span>  <span class="c1"># warn about deprecated use of old kwarg</span>
</span></span><span class="line"><span class="cl">                <span class="n">kwargs</span><span class="p">[</span><span class="n">NEW_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">emit_warning</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="sa">f</span><span class="s2">&#34;Use of keyword argument `</span><span class="si">{</span><span class="n">old_name</span><span class="si">}</span><span class="s2">` is &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="sa">f</span><span class="s2">&#34;deprecated and replaced by `</span><span class="si">{</span><span class="n">NEW_NAME</span><span class="si">}</span><span class="s2">`.  &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="sa">f</span><span class="s2">&#34;Support for `</span><span class="si">{</span><span class="n">old_name</span><span class="si">}</span><span class="s2">` will be removed &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="sa">f</span><span class="s2">&#34;in SciPy </span><span class="si">{</span><span class="n">end_version</span><span class="si">}</span><span class="s2">.&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">)</span> <span class="o">+</span> <span class="n">cmn_msg</span>
</span></span><span class="line"><span class="cl">                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">as_pos_arg</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Warn about changing meaning of positional arg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1"># Note that this decorator does not deprecate positional use of the</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># argument; it only warns that the behavior will change in the future.</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Simultaneously transitioning to keyword-only use is another option.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">position_num</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># If the argument is None and the global seed wasn&#39;t set, or if the</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># argument is one of a few new classes, the user will not notice change</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># in behavior.</span>
</span></span><span class="line"><span class="cl">                <span class="n">ok_classes</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">SeedSequence</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">BitGenerator</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">global_seed_set</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ok_classes</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">                <span class="k">elif</span> <span class="n">emit_warning</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="sa">f</span><span class="s2">&#34;Positional use of `</span><span class="si">{</span><span class="n">NEW_NAME</span><span class="si">}</span><span class="s2">` (formerly known as &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="sa">f</span><span class="s2">&#34;`</span><span class="si">{</span><span class="n">old_name</span><span class="si">}</span><span class="s2">`) is still allowed, but the behavior is &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;changing: the argument will be normalized using &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="sa">f</span><span class="s2">&#34;`np.random.default_rng` beginning in SciPy </span><span class="si">{</span><span class="n">end_version</span><span class="si">}</span><span class="s2">, &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;and the resulting `Generator` will be used to generate &#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;random numbers.&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">)</span> <span class="o">+</span> <span class="n">cmn_msg</span>
</span></span><span class="line"><span class="cl">                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">as_new_kwarg</span><span class="p">:</span>  <span class="c1"># no warnings; this is the preferred use</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># After the removal of the decorator, normalization with</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># np.random.default_rng will be done inside the decorated function</span>
</span></span><span class="line"><span class="cl">                <span class="n">kwargs</span><span class="p">[</span><span class="n">NEW_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">NEW_NAME</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">global_seed_set</span> <span class="ow">and</span> <span class="n">emit_warning</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Emit FutureWarning if `np.random.seed` was used and no PRNG was passed</span>
</span></span><span class="line"><span class="cl">                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;The NumPy global RNG was seeded by calling &#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="sa">f</span><span class="s2">&#34;`np.random.seed`. Beginning in </span><span class="si">{</span><span class="n">end_version</span><span class="si">}</span><span class="s2">, this &#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;function will no longer use the global RNG.&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span> <span class="o">+</span> <span class="n">cmn_msg</span>
</span></span><span class="line"><span class="cl">                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">wrapper</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">decorator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example usage of _prepare_rng decorator.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Suppose a library uses a custom random state normalisation function, such as</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scipy._lib._util</span> <span class="kn">import</span> <span class="n">check_random_state</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># https://github.com/scipy/scipy/blob/94532e74b902b569bfad504866cb53720c5f4f31/scipy/_lib/_util.py#L253</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Suppose a function `library_function` is defined as:</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">library_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">random_state</span> <span class="o">=</span> <span class="n">check_random_state</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># We apply the decorator and change the function signature at the same time.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The use of `random_state` throughout the function may be replaced with `rng`,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># or the variable may be defined as `random_state = rng`.</span>
</span></span><span class="line"><span class="cl"><span class="nd">@_transition_to_rng</span><span class="p">(</span><span class="s2">&#34;random_state&#34;</span><span class="p">,</span> <span class="n">position_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">library_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rng</span> <span class="o">=</span> <span class="n">check_random_state</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># After `rng` is available in all releases within the support window suggested by</span>
</span></span><span class="line"><span class="cl"><span class="c1"># SPEC 0, we pass the `end_version` param to the decorator to emit warnings.</span>
</span></span><span class="line"><span class="cl"><span class="nd">@_transition_to_rng</span><span class="p">(</span><span class="s2">&#34;random_state&#34;</span><span class="p">,</span> <span class="n">position_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_version</span><span class="o">=</span><span class="s2">&#34;1.17.0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">library_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rng</span> <span class="o">=</span> <span class="n">check_random_state</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># At the end of the deprecation period, remove the decorator, and normalize</span>
</span></span><span class="line"><span class="cl"><span class="c1"># `rng` with` np.random.default_rng`.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">library_function</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">arg1</span> <span class="o">+</span> <span class="n">arg2</span>
</span></span></code></pre></div>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Link to this heading">#</a></h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Note that in NumPy versions prior to 2.2.0, <code>numpy.random.default_rng</code> does not accept instances of <code>RandomState</code>.
In more recent versions, <code>numpy.random.default_rng</code> will convert <code>RandomState</code> instances to <code>Generator</code>s, which may not behave identically even with identical method calls.
That said, neither <code>np.random.seed</code> nor <code>np.random.RandomState</code> <em>themselves</em> are deprecated, so they may still be used directly in some contexts (e.g. by developers for generating unit test data).&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>The Hinsen principle states, loosely, that code should, whether executed now or in the future, return the same result, or raise an error.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      

<hr/>
<div id='discourse-comments'></div>
<script type="text/javascript">
  
  

  const discourse_url = "https://discuss.scientific-python.org";

  
  const notifyIFrameOfTheme = () => {
    const iframe = document.getElementById("discourse-embed-frame");
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage(
        {
          theme: document.documentElement.getAttribute("data-theme")
        },
        discourse_url
      );
    }
  };

  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName == "data-theme") {
        notifyIFrameOfTheme();
      }
    });

  });
  observer.observe(document.querySelector("html"), {
    subtree: false,
    attributes: true,
  });

  
  
  const handleMessageListener = (event) => {
    var origin = event.origin;
    if ((origin === discourse_url) && (event.data == "iframe loaded")) {
      notifyIFrameOfTheme();
    }
  };

  
  
  DiscourseEmbed = {
    discourseUrl: `${discourse_url}/`,
    discourseEmbedUrl: 'https://scientific-python.org/specs/spec-0007/',
    
  };

  (function () {
    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
    d.src = `${DiscourseEmbed.discourseUrl}javascripts/embed.js`;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();

  window.addEventListener("message", handleMessageListener);
</script>

    </div>
  </div>
  <div id="shortcuts-container">
    <div id="shortcuts">
        <div id="shortcuts-header"><i class="fa-solid fa-list"></i> On this page</div>
    </div>
</div>

</section>


    
    <div id="backtotop"><a href="#" id="backtotop-color"><i class="fa-solid fa-arrow-up"></i></a></div>

    
    

<footer id="footer">
  <div class="container">
    <div id="footer-columns">
      <div id="footer-logo-column">
        <img id="footer-logo" src="../../images/logo.svg" alt="Scientific Python logo. A green tree on a white hill at the end of a green path in the shape of the letter &#39;S&#39;.">
      </div>
      <div class="footer-column">
        <div class="footer-item">
          <a href="../../about/">
            About
          </a>
        </div>
        <div class="footer-item">
          <a href="../../roadmap/">
            Roadmap
          </a>
        </div>
        <div class="footer-item">
          <a href="../../code_of_conduct/">
            Code of Conduct
          </a>
        </div>
      </div>
      <div class="footer-column">
        <div class="footer-item">
          <a href="../../specs/">
            SPECs
          </a>
        </div>
        <div class="footer-item">
          <a href="../../summits/">
            Summits
          </a>
        </div>
        <div class="footer-item">
          <a href="../../calendars">
            Calendars
          </a>
        </div>
      </div>
      <div class="footer-column">
        <div class="footer-item">
          <a href="../../press-kit">
            Press kit
          </a>
        </div>
      </div>
        <div class="footer-actions">
          

          <div class="community-icons">
            <a href="https://github.com/scientific-python/" aria-label="https://github.com/scientific-python/">
              





<svg class="icon github-icon" viewBox="0 0 24 24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>


            </a>
            <a href="https://www.youtube.com/c/ScientificPython-org" aria-label="https://www.youtube.com/c/ScientificPython-org">
              





<svg class="icon youtube-icon" viewBox="0 0 24 24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>


            </a>
            <a href="https://fosstodon.org/@scientific_python" aria-label="https://fosstodon.org/@scientific_python">
              





<svg class="icon mastodon-icon" viewBox="0 0 24 24" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg>


            </a>
            <a href="https://discuss.scientific-python.org" aria-label="https://discuss.scientific-python.org">
              





<svg class="icon discourse-icon" viewBox="0 0 24 24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.103 0C18.666 0 24 5.485 24 11.997c0 6.51-5.33 11.99-11.9 11.99L0 24V11.79C0 5.28 5.532 0 12.103 0zm.116 4.563c-2.593-.003-4.996 1.352-6.337 3.57-1.33 2.208-1.387 4.957-.148 7.22L4.4 19.61l4.794-1.074c2.745 1.225 5.965.676 8.136-1.39 2.17-2.054 2.86-5.228 1.737-7.997-1.135-2.778-3.84-4.59-6.84-4.585h-.008z"/></svg>


            </a>
            <a href="https://discord.com/invite/vur45CbwMz" aria-label="https://discord.com/invite/vur45CbwMz">
              





<svg class="icon discord-icon" viewBox="0 0 24 24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>


            </a>
          </div>
          <div class="copyright">&copy; 2025 Scientific Python team. All rights reserved.</div>
        </div>
    </div>
  </div>
</footer>

  </body>
  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<script type="text/javascript" src=../../js/bundle.min.js></script><script type="text/javascript">setupShortcuts(maxLevel= 2 );</script>
<script defer data-domain="scientific-python.org" src="https://views.scientific-python.org/js/script.js"></script>

</html>
